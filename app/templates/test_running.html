{% extends '_mybase.html' %}


{% block content %}
    {{ super() }}

    <form style="display: inline" id='start' action="{{ url_for('blue_test.vf_cmd_start') }}" method="post">
        <button type="submit" class="btn btn-success disabled">开始</button>
    </form>
    &nbsp;&nbsp;&nbsp;
    <!--<div align="right">-->
    <div style="display: inline">
        <p style="display: inline"><strong>数量</strong>:</span> <span class="text-success"> {{ totalcount() }}</p>
    </div>


    <table class="table table-striped table-hover ">
        <thead>
            <tr>
              <th>#</th>
              <th>设备类型</th>
              <th>工厂</th>
              <th>固件版本</th>
              <th>RSSI_BLE</th>
              <th>RSSI_WIFI</th>
              <th>MAC_BLE</th>
              <th>MAC_WIFI</th>
              <th>组合指令检测</th>
              <th>信号强度检测</th>
              <th>时间</th>
              <th colspan="1">控制</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <!--
    <legend>测试中...</legend> 
    -->

    <!--<script src="//code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js" integrity="sha256-yr4fRk/GU1ehYJPAs8P4JlTgu0Hdsp4ZKrx8bDEDC3I=" crossorigin="anonymous"></script>-->
    <script src="{{ url_for('static',filename='socket.io.js') }}"></script>
    <script src="{{ url_for('static',filename='jquery-1.12.4.min.js') }}"></script>
    <script type="text/javascript" charset="utf-8">

        function jump() {
            window.location.replace("{{url_for('blue_test.process_finished')}}");
        }

        $(document).ready(function () {

            namespace = '/test';
            var socket = io(namespace);
            socket.on('progress', function (msg) {
                if (msg.newline == 1) {
                    $('#message').append('!');
                }
                $('#message').append('#');
            });

            socket.on('event_done', function () {
                // $('#message').append('<br>');
                $('#message').append('done');
                jump();
            });

            namespace = '/log';

            var socket1 = io(namespace);

            socket1.on('logupdated', function(msg) {
                // $('#log').append('<br>' + $('<div/>').text('Received #' + msg.count + ': ' + msg.data).html());
                $('#log').append('<br>' + $('<div/>').text(msg).html());
            });

        });

    </script>

    <script type="text/javascript" charset="utf-8">
        var c = 0
        var t
        function timedCount() {
            document.getElementById('timer').innerHTML = c
            // document.getElementById('errno').innerHTML = {{ errno() }}
            c = c + 1
            t = setTimeout("timedCount()", 1000)
        }
        function stopCount() {
            clearTimeout(t)
        }
    </script>

    <script type="text/javascript" charset="utf-8">
        var x = '';
        function countSecond() {
            x = (x == '.....') ? '' : (x + '.');
            document.getElementById('loading').innerText = x;
            setTimeout("countSecond()", 1000);
        }
        window.onload = countSecond;
    </script>


    <script type="text/javascript" charset="utf-8">
        function myscroll()
        {
            var div = document.getElementById('log');
            div.scrollTop = div.scrollHeight;
        }

        $(document).ready(function () {
            $('#log').on('DOMNodeInserted',function(){
                myscroll();
            });
        });
    </script>


    <div class="jumbotron alert-info" style="padding-left: 60px;padding-right: 30px">
        <h2 id="testing" style="display: inline">测试中</h1>
        <h2 id="loading" style="display: inline"></h1>
        <!--
        <div class="progress progress-striped active" >
            <div class="progress-bar" style="width: 100%"></div>
        </div>
        -->
        <br>
        <p>程序运行中，请勿刷新或关闭此页面！</p>
        <p>如果页面长时间未自动跳转，请<a style="display: inline" href="{{ url_for('blue_test.process_finished') }}"
                            class="btn btn-link">手动转到</a>测试结果页面。</p>
    </div>

<p>Debug: </p>
<p style="display: inline"><strong>1. Timer</strong></p>
<form style="display: inline">
    <input type="button" value="计时" onClick="timedCount()">
    <input type="button" value="停止" onClick="stopCount()">
</form>
<span id="timer"></span>
<p><strong>2. Event Monitor:</strong></p>
<p style="display: inline" id="message">!</p>
<p><strong>3. Log Monitor</strong></p>
<div id="log" style="overflow:auto; height: 250px; width: auto; border: 1px solid #999"></div>

{% endblock %}

