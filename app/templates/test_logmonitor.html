<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>日志监视器</title>

    <script src="{{ url_for('static',filename='socket.io.js') }}"></script>
    <script src="{{ url_for('static',filename='jquery-1.12.4.min.js') }}"></script>
    <script type="text/javascript" charset="utf-8">

         function scroll_log() {
            var div = document.getElementById('log');
            div.scrollTop = div.scrollHeight;
        }

        $(document).ready(function () {

            namespace = '/test';
            // var socket = io(namespace);
            var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);

            // 1. log monitor
            socket.on('mylog', function (msg) {
                $('#log').append('<br>' + $('<div/>').text(msg).html());
            });

            // 2. event monitor
            socket.on('myevent', function (msg) {
                if (msg.newline == 1) {
                    $('#message').append(' retry ');
                }
                $('#message').append('#');
            });

            // 3. event_done monitor
            socket.on('mydone', function () {
                $('#message').append(' done');
            });

            // 4. auto scroll down log output
            $('#log').on('DOMNodeInserted', function () {
                scroll_log();
            });
        });
    </script>
    

</head>
<body>
    <span>实时日志:</span>  |  <a href="#" onClick="window.close()">关闭</a>  |  <span id='message'></span>
    <div id="log" style="overflow:auto; height: 500px; width: auto; border: 1px solid #999"></div>
</body>
</html>
