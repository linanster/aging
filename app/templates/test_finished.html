{% extends '_mybase.html' %}

{% block content %}
  {{ super() }}


<div class="btn-group">
<form style="display: inline" action = "{{url_for('blue_test.vf_cmd_blink_all')}}" method = "post">
  <button type="submit" class="btn btn-success "{% if results|count == 0 %}disabled{% endif %}>全部闪烁</button>
</form>
<form style="display: inline" action = "{{url_for('blue_test.vf_cmd_blink_stop')}}" method = "post">
  <button type="submit" class="btn btn-danger" {% if results|count == 0 %}disabled{% endif %}>停止</button>
</form>
</div>


<table class="table table-striped table-hover ">
  <thead>
    <tr>
      <th>#</th>
      <th>设备类型</th>
      <th>工厂</th>
      <th>固件版本</th>
      <th>RSSI_BLE</th>
      <th>RSSI_WIFI</th>
      <th>MAC_BLE</th>
      <th>MAC_WIFI</th>
      <th>合格</th>
      <!-- <th>云同步</th> -->
      <th>时间</th>
      <th colspan="1">控制</th>
    </tr>
  </thead>
  <tbody>
    {% for result in results %}
    {% if not result.is_qualified %}
    {% if loop.index|string == control_index %}
    <tr class="info"> 
    {% else %}
    <tr class="warning">
    {%  endif %}
      <td>{{ loop.index}}</td>
      <td>{{result.devicename}}</td>
      <td>{{result.factoryname}}</td>
      <td>{{result.fw_version}}</td>
      <td>{{result.rssi_ble}}</td>
      <td>{{result.rssi_wifi}}</td>
      <td>{{result.mac_ble}}</td>
      <td>{{result.mac_wifi}}</td>
      <td>{{result.is_qualified}}</td>
      <!-- <td>{{result.is_sync}}</td> -->
      <td>{{result.datetime}}</td>
      <td>
        <form action = "{{url_for('blue_test.vf_cmd_blink_single')}}" method = "post">
          <input type = "hidden" name = "index" value= {{loop.index }} />
          <input type = "hidden" name = "mac" value="{{result.mac_ble}}" />
          <button type="submit" class="btn btn-primary btn-xs">闪烁</button>
        </form>
      </td>
    </tr>
    {% endif %}
    {% else %}
    {% endfor %}

    {% for result in results %}
    {% if result.is_qualified %}
    <tr class="default">
      <td>{{ loop.index}}</td>
      <td>{{result.devicename}}</td>
      <td>{{result.factoryname}}</td>
      <td>{{result.fw_version}}</td>
      <td>{{result.rssi_ble}}</td>
      <td>{{result.rssi_wifi}}</td>
      <td>{{result.mac_ble}}</td>
      <td>{{result.mac_wifi}}</td>
      <td>{{result.is_qualified}}</td>
      <!-- <td>{{result.is_sync}}</td> -->
      <td>{{result.datetime}}</td>
      <td>
        <form action = "{{url_for('blue_test.vf_cmd_blink_single')}}" method = "post">
          <input type = "hidden" name = "index" value= {{loop.index }} />
          <input type = "hidden" name = "mac" value="{{result.mac_ble}}" />
          <button type="submit" class="btn btn-primary btn-xs">闪烁</button>
        </form>
      </td>
    </tr>
    {% endif %}
    {% else %}
    {% endfor %}
  </tbody>
</table> 

  {%- for message in get_flashed_messages() %}
<div class="alert alert-dismissible alert-success">
  <button type="button" class="close" data-dismiss="alert">&times;</button>
  <strong>{{ message }}</strong> 
</div>
  {% endfor %}

<div>
  <div>
  </div>
<div>
  <br>
  <br>


{% endblock %}


