{% extends '_mybase.html' %}

{% block content %}
    {{ super() }}
    {% include '_configinfo.html' %}

    <div class="btn-group">
        <form style="display: inline" action="{{ url_for('blue_test.vf_finished') }}" method="get">
            <button type="submit" class="btn btn-primary">刷新</button>
        </form>
        <form style="display: inline" action="{{ url_for('blue_test.cmd_download_testdatas') }}" method="post">
            <button type="submit" class="btn btn-primary" {% if results|count == 0 %}disabled{% endif %}>下载报表</button>
        </form>
        &nbsp;&nbsp;&nbsp;&nbsp;
        <form style="display: inline" action="{{ url_for('blue_test.cmd_allon') }}" method="post">
            <button type="submit" class="btn btn-success" {% if results|count == 0 %}disabled{% endif %}>全部点亮</button>
        </form>
        <form style="display: inline" action="{{ url_for('blue_test.cmd_alloff') }}" method="post">
            <button type="submit" class="btn btn-danger" {% if results|count == 0 %}disabled{% endif %}>全部熄灭</button>
        </form>
        <form style="display: inline" action="{{ url_for('blue_test.vf_cmd_blink_all') }}" method="post">
            <button type="submit" class="btn btn-success" {% if results|count == 0 %}disabled{% endif %}>全部闪烁</button>
        </form>
        <form style="display: inline" action="{{ url_for('blue_test.vf_cmd_blink_stop') }}" method="post">
            <button type="submit" class="btn btn-danger" {% if results|count == 0 %}disabled{% endif %}>停止闪烁</button>
        </form>
        &nbsp;&nbsp;&nbsp;&nbsp;
        <form style="display: inline" action="{{ url_for('blue_test.cmd_kickout') }}" method="post">
            <button type="submit" class="btn btn-danger" {% if results|count == 0 %}disabled{% endif %}>Kickout</button>
        </form>
        {% if devicecode() in [67, 66] %}
            &nbsp;&nbsp;&nbsp;&nbsp;
            <form style="display: inline" action="{{ url_for('blue_test.cmd_indicator_r') }}" method="post">
                <button type="submit" class="btn btn-success" {% if results|count == 0 %}disabled{% endif %}>指示灯R</button>
            </form>
            <form style="display: inline" action="{{ url_for('blue_test.cmd_indicator_g') }}" method="post">
                <button type="submit" class="btn btn-success" {% if results|count == 0 %}disabled{% endif %}>指示灯G</button>
            </form>
            <form style="display: inline" action="{{ url_for('blue_test.cmd_indicator_b') }}" method="post">
                <button type="submit" class="btn btn-success" {% if results|count == 0 %}disabled{% endif %}>指示灯B</button>
            </form>
        {% endif %}
    </div>


    <table class="table table-striped table-hover ">
        <!--
        <thead>
        <tr>
            <th rowspan="2">#</th>
            <th rowspan="2">设备类型</th>
            <th rowspan="2">工厂</th>
            <th rowspan="2">固件版本</th>
            <th rowspan="2">RSSI_BLE</th>
            <th rowspan="2">RSSI_WIFI</th>
            <th rowspan="2">MAC_BLE</th>
            <th rowspan="2">MAC_WIFI</th>
            <th rowspan="2">MCU</th>
            <th colspan="5">检测结果</th>
            <th rowspan="2">时间</th>
            <th rowspan="2">控制</th>
        </tr>
        <tr>
            <th>信号强度</th>
            <th>组合指令</th>
            <th>广播扫描</th>
            <th>设备类型</th>
            <th>版本检测</th>
        </tr>
        </thead>
        -->
        {% include '_thead.html' %}
        <tbody>
        {% for result in results %}
            {% if not result.bool_qualified_signal or not result.bool_qualified_check or not result.bool_qualified_scan or not result.bool_qualified_deviceid or not result.reserve_bool_1 %}
                {% if loop.index|string == control_index %}
                    <tr class="warning">
                {% else %}
                    <tr class="info">
                {% endif %}
            <td>{{ loop.index }}</td>
            <td>{{ result.device.name }}</td>
            <td>{{ result.factory.name }}</td>
            <td>{{ result.fw_version }}</td>
            <td>{{ result.rssi_ble1 }}</td>
            <td>{{ result.rssi_wifi1 }}</td>
            <td>{{ result.mac_ble }}</td>
            <td>{{ result.mac_wifi }}</td>
            <td>{{ result.reserve_str_1 }}</td>
            <td>{{ result.bool_qualified_signal|parse_is_qualified }}</td>
            <td>{{ result.bool_qualified_check|parse_is_qualified }}({{result.status_cmd_check2}})</td>
            <td>{{ result.bool_qualified_scan|parse_is_qualified }}</td>
            <td>{{ result.bool_qualified_deviceid|parse_is_qualified }}</td>
            <td>{{ result.reserve_bool_1|parse_is_qualified }}</td>
            <td>{{ result.datetime }}</td>
            <td>
                <form action="{{ url_for('blue_test.vf_cmd_blink_single') }}" method="post">
                    <input type="hidden" name="index" value="{{ loop.index }}"/>
                    <input type="hidden" name="mac" value="{{ result.mac_ble }}"/>
                    <button type="submit" class="btn btn-primary btn-xs">闪烁</button>
                </form>
            </td>
            </tr>
            {% endif %}
        {% else %}
        {% endfor %}

        {% for result in results %}
            {% if result.bool_qualified_signal and result.bool_qualified_check and result.bool_qualified_scan and result.bool_qualified_deviceid and result.reserve_bool_1%}
                <tr class="default">
                    <td>{{ loop.index }}</td>
                    <td>{{ result.device.name }}</td>
                    <td>{{ result.factory.name }}</td>
                    <td>{{ result.fw_version }}</td>
                    <td>{{ result.rssi_ble1 }}</td>
                    <td>{{ result.rssi_wifi1 }}</td>
                    <td>{{ result.mac_ble }}</td>
                    <td>{{ result.mac_wifi }}</td>
                    <td>{{ result.reserve_str_1 }}</td>
                    <td>{{ result.bool_qualified_signal|parse_is_qualified }}</td>
                    <td>{{ result.bool_qualified_check|parse_is_qualified }}({{result.status_cmd_check2}})</td>
                    <td>{{ result.bool_qualified_scan|parse_is_qualified }}</td>
                    <td>{{ result.bool_qualified_deviceid|parse_is_qualified }}</td>
                    <td>{{ result.reserve_bool_1|parse_is_qualified }}</td>
                    <td>{{ result.datetime }}</td>
                    <td>
                        <!--
                        <form action="{{ url_for('blue_test.vf_cmd_blink_single') }}" method="post">
                            <input type="hidden" name="index" value={{ loop.index }}/>
                            <input type="hidden" name="mac" value="{{ result.mac_ble }}"/>
                            <button type="submit" class="btn btn-primary btn-xs">闪烁</button>
                        </form>
                       -->
                      -
                    </td>
                </tr>
            {% endif %}
        {% else %}
        {% endfor %}
        </tbody>
    </table>

    {%- for message in get_flashed_messages() %}
        <div class="alert alert-dismissible alert-success">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            <strong>{{ message }}</strong>
        </div>
    {% endfor %}

    <div>
    <div>
    </div>
    <div>
    <br>
    <br>

{% endblock %}

